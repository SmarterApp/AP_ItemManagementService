package org.opentestsystem.ap.ims.rest.v1;

import io.swagger.annotations.Api;
import lombok.extern.slf4j.Slf4j;
import org.opentestsystem.ap.ims.model.SavedSearchModel;
import org.opentestsystem.ap.ims.service.SavedSearchService;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@Slf4j
@RestController
@RequestMapping("/api/v1/items/savedSearch")
@Api
public class SavedSearchApi {

    private final SavedSearchService savedSearchService;

    public SavedSearchApi(final SavedSearchService savedSearchService) {
        this.savedSearchService = savedSearchService;
    }

    // ------------------------------------------------------------------------
    // Saved Search
    // ------------------------------------------------------------------------

    @PostMapping
    public void saveSavedSearch(@RequestBody final SavedSearchModel.SaveSearchRequest model) {
        log.debug("create saved search");
        savedSearchService.saveSavedSearch(model);
    }

    @GetMapping("/{userName:.+}")
    public List<SavedSearchModel.SavedSearchResponse> retrieveSavedSearches(@PathVariable final String userName) {
        log.debug("retrieve saved searches");
        List<SavedSearchModel.SavedSearchResponse> savedSearches = savedSearchService.findSavedSearches(userName);
        return savedSearches;
    }

    @DeleteMapping("/{userName}/{searchName:.+}")
    public void deleteSavedSearch(@PathVariable final String userName, @PathVariable final String searchName) {
        log.debug("delete saved search");
        savedSearchService.deleteSavedSearch(userName, searchName);
    }
}

