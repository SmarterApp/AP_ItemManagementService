package org.opentestsystem.ap.ims.entity;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.ToString;
import lombok.extern.slf4j.Slf4j;
import org.hibernate.annotations.Type;

import javax.persistence.Embeddable;
import javax.persistence.EmbeddedId;
import javax.persistence.Entity;
import javax.persistence.OneToMany;
import javax.validation.constraints.NotNull;
import java.io.Serializable;
import java.util.Set;

@Getter
@Entity
@ToString
@NoArgsConstructor
@AllArgsConstructor
@EqualsAndHashCode
public class SavedSearch implements Serializable {

    @Data
    @Embeddable
    @NoArgsConstructor
    @AllArgsConstructor
    @EqualsAndHashCode
    @ToString
    public static class SavedSearchIdentity implements Serializable {

        @NotNull
        private String userName;

        @NotNull
        private String searchName;
    }

    @EmbeddedId
    private SavedSearchIdentity id;

    @NotNull
    @Type(type="text")
    private String searchJson;

    @OneToMany(mappedBy = "savedSearch")
    private Set<SharedSavedSearch> sharedSavedSearches;

    public SavedSearch(String userName, String searchName, String searchJson) {
        this.id = new SavedSearchIdentity(userName, searchName);
        this.searchJson = searchJson;
    }

    public SavedSearch(SavedSearchIdentity id, String searchJson) {
        this.id = id;
        this.searchJson = searchJson;
    }

}
