package org.opentestsystem.ap.ims.service.export;

import org.opentestsystem.ap.common.datastore.preview.DataStorePreviewManager;
import org.opentestsystem.ap.common.model.preview.PreviewData;
import org.opentestsystem.ap.common.security.SecurityUtil;
import org.springframework.stereotype.Repository;

import java.nio.file.Path;

@Repository
public class ItemExportRepositoryImpl implements ItemExportRepository {

    private final SecurityUtil securityUtil;

    private final DataStorePreviewManager dataStorePreviewManager;

    public ItemExportRepositoryImpl(final SecurityUtil securityUtil,
                                    DataStorePreviewManager dataStorePreviewManager) {
        this.securityUtil = securityUtil;
        this.dataStorePreviewManager = dataStorePreviewManager;
    }

    @Override
    public Path cloneItemForExport(final Path exportDirectory, final String itemId) {
        PreviewData pd = this.dataStorePreviewManager
            .generatePreviewData(securityUtil.getItemBankUser(), itemId);
        return pd.getRepositoryPath();
    }
}
