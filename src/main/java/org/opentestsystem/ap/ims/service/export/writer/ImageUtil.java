package org.opentestsystem.ap.ims.service.export.writer;

import org.apache.batik.transcoder.TranscoderException;
import org.apache.batik.transcoder.TranscoderInput;
import org.apache.batik.transcoder.TranscoderOutput;
import org.apache.batik.transcoder.image.PNGTranscoder;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;

public class ImageUtil {
    public static File createImageFromSVG(File directory, File file, float width, float height) {
        PNGTranscoder t = new PNGTranscoder();

        // Set the transcoding hints.
        if (width > 0) {
            t.addTranscodingHint(PNGTranscoder.KEY_WIDTH, width);
        }

        if (height > 0) {
            t.addTranscodingHint(PNGTranscoder.KEY_HEIGHT, height);
        }

        // Create the transcoder input.
        String svgURI = file.toURI().toString();
        TranscoderInput input = new TranscoderInput(svgURI);

        String pngFileName = file.getName().replace(".svg", ".png");

        File png = new File(directory, pngFileName);
        // Create the transcoder output.
        try (OutputStream os = new FileOutputStream(png)) {
            TranscoderOutput output = new TranscoderOutput(os);

            // Save the image.
            t.transcode(input, output);
            os.flush();
        } catch (TranscoderException | IOException e) {
            throw new RuntimeException("failed to create png from svg " + file, e);
        }

        return png;
    }
}
