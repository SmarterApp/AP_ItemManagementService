package org.opentestsystem.ap.ims.model.export;

import org.apache.commons.lang3.StringUtils;
import org.opentestsystem.ap.common.model.AssessmentItem;
import org.opentestsystem.ap.common.model.Item;

import java.time.LocalDateTime;
import java.time.ZoneOffset;
import java.time.format.DateTimeFormatter;

public class AdditionalInfo {
    private String associatedStimulusId;
    private String version;
    private String type;
    private String subject;
    private String intendedGrade;
    private String exportDate;
    private String user;

    public AdditionalInfo(final String associatedStimulusId, final String version, final String type, final String subject, final String intendedGrade, final String exportDate, final String user) {
        this.associatedStimulusId = associatedStimulusId;
        this.version = version;
        this.type = type;
        this.subject = subject;
        this.intendedGrade = intendedGrade;
        this.exportDate = exportDate;
        this.user = user;
    }

    public String getAssociatedStimulusId() {
        return associatedStimulusId;
    }

    public String getVersion() {
        return version;
    }

    public String getType() {
        return type;
    }

    public String getSubject() {
        return subject;
    }

    public String getIntendedGrade() {
        return intendedGrade;
    }

    public String getExportDate() {
        return exportDate;
    }

    public String getUser() {
        return user;
    }

    public static AdditionalInfo create(ItemExport itemExport) {
        final Item item = itemExport.getItem();
        String stimulusId = StringUtils.EMPTY;
        if(item instanceof AssessmentItem) {
            ((AssessmentItem) item).getCore().getStimulusId();
        }

        LocalDateTime datetime = LocalDateTime.ofInstant(itemExport.getExportDate(), ZoneOffset.UTC);
        String formattedDate = DateTimeFormatter.ofPattern("yyyy-MM-dd").format(datetime);

        return new AdditionalInfo(stimulusId,
                item.getVersion(),
                item.getType(),
                item.getCore().getMetadata().getSubject(),
                item.getCore().getMetadata().getIntendedGrade(),
                formattedDate,
                itemExport.getUser());
    }
}
